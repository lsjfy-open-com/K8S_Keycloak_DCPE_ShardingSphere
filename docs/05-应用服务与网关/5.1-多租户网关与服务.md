# 5.1 多租户网关与服务

## 5.1.1 概述

本节详细描述基于Kong/Istio的多租户API网关和服务网格实现方案。

## 5.1.2 API网关架构

### Kong网关配置

```yaml
# kong-gateway.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kong-gateway
  namespace: gateway
spec:
  replicas: 3
  selector:
    matchLabels:
      app: kong-gateway
  template:
    metadata:
      labels:
        app: kong-gateway
    spec:
      containers:
      - name: kong-gateway
        image: kong:3.5.0
        ports:
        - name: http
          containerPort: 8000
        - name: https
          containerPort: 8443
        - name: admin
          containerPort: 8001
        env:
        - name: KONG_DATABASE
          value: "postgres"
        - name: KONG_PG_DATABASE
          value: "kong"
```

### 租户路由配置

```yaml
# tenant-routing.yaml
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: tenant-routing
config:
  tenant_id_header: "X-Tenant-ID"
  routes:
    - tenant: tenant-a
      service: app-a-service
      host: app-a.customer.com
    - tenant: tenant-b
      service: app-b-service
      host: app-b.customer.com
```

## 5.1.3 限流策略

```yaml
# rate-limiting.yaml
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: tenant-rate-limit
config:
  minute: 100
  hour: 1000
  policy: local
  fault_tolerant: true
```

## 5.1.4 交付物清单

- [ ] 网关架构设计文档
- [ ] 路由配置清单
- [ ] 限流策略文档
- [ ] 负载均衡配置
- [ ] mTLS配置文档

## 5.1.5 工时估算

| 任务 | 工时 |
|-----|------|
| Kong部署 | 3人天 |
| 路由配置 | 3人天 |
| 限流策略 | 2人天 |
| mTLS配置 | 2人天 |
| 测试验证 | 2人天 |
| **总计** | **12人天** |

## 5.1.6 相关文档

- [主项目文档](../项目工作分解结构.md)
