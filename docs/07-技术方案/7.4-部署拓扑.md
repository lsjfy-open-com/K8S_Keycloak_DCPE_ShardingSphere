# 7.4 部署拓扑

## 7.4.1 K8s集群拓扑

### 生产环境部署架构
```
┌─────────────────────────────────────────────────────────────────┐
│                      K8s Master节点（3个）                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │
│  │  Master-1   │  │  Master-2   │  │  Master-3              │ │
│  │  etcd       │  │  etcd       │  │  etcd                  │ │
│  │  API Server │  │  API Server │  │  API Server            │ │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────┐
│                      K8s Worker节点（可扩展）                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  Worker-1   │  │  Worker-2   │  │  Worker-N   │             │
│  │  网关服务    │  │  应用服务    │  │  数据服务   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────┐
│                      存储层                                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │  NFS存储       │  │  对象存储       │  │  块存储         │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 7.4.2 网络分区设计

### 网络拓扑
```
┌─────────────────────────────────────────────────────────────────┐
│                        DMZ区域                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Kong API网关（公网入口）                               │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────┐
│                      应用区域                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │
│  │  Keycloak   │  │  应用Pod    │  │  ShardingSphere        │ │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────┐
│                      数据区域                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │  高斯数据库     │  │  Milvus         │  │  Redis          │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 7.4.3 资源规划

### 节点配置建议

| 节点类型 | CPU | 内存 | 磁盘 | 数量 |
|---------|-----|------|------|------|
| Master | 8核 | 32GB | 200GB SSD | 3 |
| Worker-网关 | 8核 | 16GB | 200GB SSD | 2 |
| Worker-应用 | 16核 | 64GB | 500GB SSD | 4 |
| Worker-数据 | 16核 | 128GB | 1TB SSD | 3 |

## 7.4.4 高可用架构

### HA设计要点
1. Master节点：3节点etcd集群
2. 应用服务：多副本部署
3. 数据库：主从复制
4. 负载均衡：Kong + kube-proxy

## 7.4.5 相关文档

- [总体架构设计](./7.1-总体架构设计.md)
- [集成方案](./7.3-集成方案.md)
- [安全架构](./7.5-安全架构.md)
