# 3.2 ODBC数据访问层

## 3.2.1 概述

本节详细描述ODBC数据访问组件的开发实现，包括连接池管理、查询构建和性能优化。

## 3.2.2 ODBC组件架构

```java
// ODBC数据访问组件
public class ODBCDataAccessLayer {
    
    private HikariConfig config;
    private HikariDataSource dataSource;
    
    public ODBCDataAccessLayer(ODBCConfig odConfig) {
        this.config = new HikariConfig();
        this.config.setJdbcUrl(odConfig.getJdbcUrl());
        this.config.setUsername(odConfig.getUsername());
        this.config.setPassword(odConfig.getPassword());
        this.config.setMaximumPoolSize(odConfig.getMaxPoolSize());
        this.config.setMinimumIdle(odConfig.getMinIdle());
        this.config.setConnectionTimeout(odConfig.getConnectionTimeout());
        this.dataSource = new HikariDataSource(config);
    }
    
    public List<Map<String, Object>> executeQuery(String sql, Object... params) {
        try (Connection conn = dataSource.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            // 参数绑定
            for (int i = 0; i < params.length; i++) {
                stmt.setObject(i + 1, params[i]);
            }
            
            // 执行查询
            ResultSet rs = stmt.executeQuery();
            return resultSetToList(rs);
            
        } catch (SQLException e) {
            throw new DataAccessException("查询执行失败", e);
        }
    }
}
```

## 3.2.3 连接池配置

```yaml
# connection-pool-config.yaml
datasources:
  - name: gaussdb
    url: jdbc:postgresql://gaussdb:5432/appdb
    pool:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
    driver-class-name: org.postgresql.Driver
```

## 3.2.4 交付物清单

- [ ] ODBC组件源代码
- [ ] ShardingSphere集成配置
- [ ] 连接池配置文档
- [ ] 异常处理规范
- [ ] API使用文档

## 3.2.5 工时估算

| 任务 | 工时 |
|-----|------|
| ODBC组件开发 | 4人天 |
| 连接池配置 | 3人天 |
| 异常处理 | 2人天 |
| 性能优化 | 3人天 |
| 测试验证 | 3人天 |
| **总计** | **15人天** |

## 3.2.6 相关文档

- [访问控制引擎](./3.1-访问控制引擎.md)
- [主项目文档](../项目工作分解结构.md)
